<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minhas Questões do Exame de Suficiência</title>
    
    <style>
        /* --- Configurações Gerais --- */
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            line-height: 1.6;
            background-color: #f0f2f5;
            color: #1c1e21;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        header {
            background-color: #004a91;
            color: #ffffff;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        header h1 { margin: 0; }
        /* Título antigo "Contabilidade Societária" removido */

        /* --- Estilos das Tabs --- */
        .tab-nav {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
            flex-wrap: wrap;
            justify-content: center;
        }
        .tab-button {
            padding: 10px 5px;
            font-size: 1.1em;
            font-weight: 500;
            border: none;
            background-color: transparent;
            cursor: pointer;
            color: #555;
            border-bottom: 3px solid transparent;
            transition: border-color 0.2s, color 0.2s;
        }
        .tab-button:hover { color: #004a91; }
        .tab-button.active {
            color: #004a91;
            font-weight: 600;
            border-bottom: 3px solid #004a91;
        }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }
        
        /* Estilo genérico para abas de texto */
        #tab-sobre, #tab-termos, #tab-privacidade {
            background-color: #ffffff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #tab-sobre h3, #tab-termos h3, #tab-privacidade h3 {
            margin-top: 0; color: #004a91; border-bottom: 1px solid #ddd; padding-bottom: 10px;
        }
        
        /* (NOVO) Estilo para links internos das tabs */
        .inline-tab-link {
            color: #004a91;
            text-decoration: underline;
            cursor: pointer;
            font-weight: 500;
        }
        .inline-tab-link:hover {
            color: #003366;
        }


        /* --- Área de Filtros --- */
        .filter-container {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .filter-container h3 {
            margin-top: 0;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            color: #004a91;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        /* (NOVO) Estilo para agrupar botões no h3 */
        .filter-container h3 > span {
            display: flex;
            gap: 8px; 
            align-items: center;
        }
        .filter-container h3 button {
            font-size: 0.8em;
            font-weight: normal;
            padding: 4px 8px;
            border: 1px solid #004a91;
            background-color: #f0f2f5;
            color: #004a91;
            border-radius: 4px;
            cursor: pointer;
        }
        .filter-container h3 button:hover { background-color: #e4e6eb; }


        /* --- (NOVO) Filtro de Disciplina --- */
        #disciplina-checkbox-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        #disciplina-checkbox-container label {
            display: flex;
            align-items: center;
            background-color: #e6f7ff; /* Cor de destaque para disciplina */
            padding: 10px 14px;
            border-radius: 5px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 1px solid #b3e0ff;
        }
        #disciplina-checkbox-container label:hover { background-color: #d0ebff; }
        #disciplina-checkbox-container input { margin-right: 10px; }


        /* --- Filtro de Exame/Ano --- */
        .ano-filter-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            align-items: start;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
        }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: 600; margin-bottom: 5px; font-size: 0.9em; }
        .form-group select {
            padding: 10px; font-size: 0.95em; border: 1px solid #ccc; border-radius: 5px; background-color: #fff;
        }
        #exame-checkbox-container {
            display: flex; flex-wrap: wrap; gap: 10px; align-items: center;
        }
        #exame-checkbox-container label {
            display: flex; align-items: center; background-color: #f0f2f5; padding: 8px 12px;
            border-radius: 5px; font-size: 0.9em; cursor: pointer; transition: background-color 0.2s; margin: 0;
        }
        #exame-checkbox-container label:hover { background-color: #e4e6eb; }
        #exame-checkbox-container input { margin-right: 8px; }
        
        /* Campo de pesquisa */
        #search-input {
            width: 100%; padding: 10px; font-size: 0.95em; border: 1px solid #ccc;
            border-radius: 5px; background-color: #fff; box-sizing: border-box; 
        }

        /* --- (NOVO) Estilo para o campo de busca de ementas --- */
        .ementa-search-container {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        #search-ementas-input {
            width: 100%;
            padding: 8px 12px;
            font-size: 0.95em;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box; 
        }

        /* --- (MODIFICADO) Filtro de Ementa --- */
        #checkbox-container {
            display: flex; /* Alterado de grid para flex */
            flex-direction: column; /* Para empilhar os grupos */
            gap: 20px; /* Espaço ENTRE os grupos de disciplina */
            margin-bottom: 15px;
        }
        
        /* (NOVO) Estilos para os grupos de ementa */
        .ementa-group-label {
            font-size: 1.1em;
            font-weight: 600;
            color: #004a91; /* Cor dos títulos de filtro */
            margin: 0 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
        }
        .ementa-group-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }
        .ementa-group-grid label {
            display: flex; align-items: center; background-color: #f0f2f5; padding: 8px 12px;
            border-radius: 5px; font-size: 0.9em; cursor: pointer; transition: background-color 0.2s;
        }
        .ementa-group-grid label:hover { background-color: #e4e6eb; }
        .ementa-group-grid input { margin-right: 8px; }
        
        #btn-clear-filters {
            background-color: #6c757d; color: white; border: none; padding: 10px 15px;
            border-radius: 5px; cursor: pointer; font-size: 0.9em; margin-right: 10px;
        }
        #btn-clear-filters:hover { background-color: #5a6268; }
        
        #filter-info {
            display: inline-block; font-size: 0.9em; color: #555; font-style: italic;
        }

        /* --- (NOVO) Aviso inicial --- */
        #initial-prompt {
            text-align: center;
            padding: 40px 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        #initial-prompt p {
            font-size: 1.2em;
            color: #004a91;
            margin: 0;
            font-weight: 500;
        }

        /* --- Área das Questões --- */
        .questao-card {
            background-color: #ffffff; border: 1px solid #ddd; border-radius: 8px;
            padding: 25px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .questao-header {
            display: flex;
            justify-content: space-between; /* Coloca h4 na esquerda e .questao-meta na direita */
            align-items: center; /* Alinha verticalmente */
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap; /* Permite quebrar a linha em telas pequenas */
            gap: 10px;
        }
        .questao-header h4 {
            font-size: 1.1em;
            color: #004a91;
            margin: 0;
            white-space: nowrap; /* Garante que 'Questão 123' não quebre */
            flex-shrink: 0;
        }
        
        /* (NOVO) Estilo para o container da direita */
        .questao-meta {
            display: flex;
            flex-wrap: wrap; /* Permite que as tags quebrem a linha se forem muitas */
            justify-content: flex-end; /* Alinha as tags à direita */
            gap: 8px; /* Espaçamento entre as tags (banca, exame, etc) */
            align-items: center;
        }
        
        /* (NOVO) Container da disciplina na linha de baixo */
        .questao-disciplina-container {
            margin-top: -10px; /* Puxa para perto da borda do header */
            margin-bottom: 15px; /* Espaço antes do enunciado */
        }

        /* (MODIFICADO) Tag de Disciplina (seletor genérico) */
        .disciplina {
            font-size: 0.9em;
            font-weight: bold;
            color: #004a91;
            background-color: #e6f7ff;
            padding: 3px 8px;
            border-radius: 4px;
        }
        .questao-header span {
            font-size: 0.9em; font-weight: bold; color: #444; white-space: nowrap;
        }
        .questao-header .banca {
            font-size: 0.85em; font-weight: normal; color: #667; background-color: #eee;
            padding: 2px 6px; border-radius: 4px; 
        }
        .questao-header .tag-obsoleta {
            font-size: 0.8em; font-weight: bold; color: #d9534f; background-color: #fcf8e3;
            border: 1px solid #d9534f; padding: 2px 6px; border-radius: 4px; 
            white-space: nowrap;
        }
        
        .enunciado { white-space: pre-wrap; font-size: 1.1em; margin-bottom: 20px; }
        .opcoes ul { list-style-type: none; padding: 0; margin: 0; }
        
        .opcoes li {
            padding: 12px; border: 1px solid #eee; margin-bottom: 8px; border-radius: 5px;
            white-space: pre-wrap; cursor: pointer; transition: background-color 0.2s, border-color 0.2s;
        }
        .opcoes-lista .opcao-clicavel:hover { background-color: #f0f2f5; border-color: #004a91; }
        .opcao-incorreta {
            background-color: #fff0f0; border-color: #d9534f; color: #d9534f; font-weight: bold;
        }
        .opcao-correta {
            background-color: #e6ffed; border-color: #28a745; color: #218838; font-weight: bold;
        }
        .quiz-hint {
            display: block; font-style: italic; color: #555; font-size: 0.9em;
            margin-top: 15px; text-align: center;
        }
        
        .resposta-correta {
            display: none; margin-top: 15px; padding: 15px; background-color: #e6ffed;
            border: 1px solid #28a745; border-radius: 5px;
        }
        .resposta-correta .gabarito-texto {
             white-space: pre-wrap; font-weight: bold; color: #218838;
        }
        .resposta-correta .resolucao-texto {
            margin-top: 15px; padding-top: 15px; border-top: 1px dashed #aaa;
            font-weight: normal; color: #333; white-space: pre-wrap;
        }
        .resposta-correta .sem-resolucao {
            margin-top: 15px; padding-top: 15px; border-top: 1px dashed #aaa;
            font-weight: normal; font-style: italic; color: #555;
        }

        /* Botão Voltar ao Topo */
        #btn-back-to-top {
            display: none; position: fixed; bottom: 20px; right: 30px; z-index: 99;
            font-size: 18px; border: none; outline: none; background-color: #004a91;
            color: white; cursor: pointer; padding: 12px 16px; border-radius: 5px;
            transition: background-color 0.2s; line-height: 1;
        }
        #btn-back-to-top:hover { background-color: #003366; }
        
        /* Rodapé */
        .site-footer {
            text-align: center; padding: 20px; color: #555; font-size: 13px; border-top: 1px solid #ddd;
        }
        .site-footer p { margin: 8px 0; }
        .site-footer a { color: #004a91; text-decoration: none; }
        .site-footer a:hover { text-decoration: underline; }


        /* Ajustes Responsivos */
        @media (max-width: 700px) {
            .ano-filter-grid { grid-template-columns: 1fr; }
            #exame-checkbox-container { border-top: 1px solid #eee; padding-top: 15px; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Questões do Exame de Suficiência de Contabilidade</h1>
            </header>

        <nav class="tab-nav">
            <button class="tab-button active" data-target="tab-questoes">Questões</button>
            <button class="tab-button" data-target="tab-sobre">Sobre</button>
            <button class="tab-button" data-target="tab-termos">Termos de Uso</button>
            <button class="tab-button" data-target="tab-privacidade">Política de Privacidade</button>
        </nav>

        <div class="tab-content">
        
            <div id="tab-questoes" class="tab-panel active">
                <section class="filter-container">
                    
                    <h3>
                        Filtrar por Disciplina:
                        <button id="btn-check-all-disciplinas" data-checked="false">Marcar Todas</button>
                    </h3>
                    <div id="disciplina-checkbox-container">
                        </div>

                    <div class="ano-filter-grid">
                        <div class="form-group">
                            <label for="sort-ano">Ordenar por Ano:</label>
                            <select id="sort-ano">
                                <option value="decrescente">Mais Recentes (Decrescente)</option>
                                <option value="crescente">Mais Antigos (Crescente)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Selecionar Exames Específicos:</label>
                            <div id="exame-checkbox-container">
                                </div>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 20px; border-top: 1px solid #eee; padding-top: 20px;">
                        <label style="margin-bottom: 8px;">
                            Mostrar questões obsoletas? 
                            <span id="obsoleta-tooltip-trigger" title="Questões obsoletas são aquelas cujo gabarito pode ter sido alterado por novas normas ou revogações. Elas são úteis para entender a evolução da banca, mas não para fixar o conteúdo atual." style="font-weight: normal; font-size: 0.9em; cursor: help; color: #004a91; border: 1px solid #004a91; border-radius: 50%; padding: 0px 5px;">?</span>
                        </label>
                        <div id="obsoleta-radio-container">
                            <label for="obsoleta-sim" style="font-weight: normal; margin: 0; cursor: pointer;">
                                <input type="radio" id="obsoleta-sim" name="obsoleta-filter" value="sim" checked style="margin-right: 5px;">
                                Sim (Padrão)
                            </label>
                            <label for="obsoleta-nao" style="font-weight: normal; margin: 0 0 0 20px; cursor: pointer;">
                                <input type="radio" id="obsoleta-nao" name="obsoleta-filter" value="nao" style="margin-right: 5px;">
                                Não (Ocultar obsoletas)
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label for="search-input">Pesquisar por Palavra-Chave:</label>
                        <input type="text" id="search-input" placeholder="Digite um termo (ex: imposto, veiculo, NBC TG 27)...">
                    </div>

                    <h3>
                        Filtrar por Ementa (Tópico):
                        <span> <button id="btn-toggle-ementas" data-visible="true" title="Ocultar/Exibir Ementas">[ Ocultar ]</button>
                            <button id="btn-check-all-ementas" data-checked="false">Marcar Todas</button>
                        </span>
                    </h3>
                    
                    <div id="ementas-toggle-wrapper"> 
                    
                        <div class="ementa-search-container">
                            <input type="text" id="search-ementas-input" placeholder="Buscar ementa específica...">
                        </div>
                    
                        <div id="checkbox-container">
                            </div>
                        
                    </div>
                    <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">

                    <button id="btn-clear-filters">Limpar Todos os Filtros</button>
                    <span id="filter-info"></span>
                </section>

                <div id="initial-prompt">
                    <p>&#8593; Por favor, selecione uma ou mais disciplinas acima para começar.</p>
                </div>

                <main id="questoes-container" style="display: none;">
                    </main>
            </div>
            
            <div id="tab-sobre" class="tab-panel">
                <h3>Sobre o Projeto</h3>
                <p>
                    Este é um projeto educacional independente, desenvolvido com o objetivo de centralizar
                    e facilitar o estudo para o Exame de Suficiência (CFC).
                </p>
                <p>
                    Todo o conteúdo é disponibilizado de forma gratuita e o projeto é mantido
                    com a licença <strong>AGPL-3.0</strong>, o que significa que é um software livre.
                    Você pode copiar, modificar e distribuir sua própria versão, desde que mantenha
                    a mesma licença.
                </p>

                <h4>Contribuidores</h4>
                <p>
                    Obrigado a todos que ajudaram a construir e revisar este banco de questões!
                </p>
                <ul>
                    <li><strong>elrunix12</strong> (Desenvolvimento inicial e manutenção)</li>
                    <li>Seu nome/apelido pode aparecer aqui se você contribuir!</li>
                </ul>

                <h4>Como Contribuir?</h4>
                <p>
                    Encontrou um erro, tem uma sugestão ou quer adicionar questões de provas
                    mais recentes? Use o nosso método preferencial:
                </p>
                <ul>
                    <li>
                        <strong>(Preferencial)</strong> 
                        <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=DQSIkWdsW0yxEjajBLZtrQAAAAAAAAAAAAYAAF_bnDZUODNHWlVVRFNBNlgwUDlXTUU1VEQ2MEJNRS4u" target="_blank" rel="noopener noreferrer">
                            Preencha nosso formulário de contribuição
                        </a>
                    </li>
                    <li>
                        Para contribuições técnicas (código), visite o 
                        <a href="https://github.com/elrunix12/balanceterno" target="_blank" rel="noopener noreferrer">
                            repositório do projeto no GitHub
                        </a>.
                    </li>
                    <li>
                        Antes de enviar sua contribuição, por favor, leia nossos 
                        <a href="#" class="inline-tab-link" data-target-tab="tab-termos">Termos de Uso</a> (especialmente a seção 5)
                        e nossa 
                        <a href="#" class="inline-tab-link" data-target-tab="tab-privacidade">Política de Privacidade</a>.
                    </li>
                    <li style="margin-bottom: 8px;">
                        <strong>
                            <a href="status.html" target="_blank">Veja o Status das Questões</a>
                        </strong>
                        (Confira quais exames e resoluções estão faltando).
                    </li>
                </ul>

                <h4>Créditos e Inspirações</h4>
                <p>
                    O <strong>Balanceterno</strong> existe graças à filosofia do <strong>software livre</strong>.
                    Somos profundamente gratos à comunidade <strong>GNU/Linux</strong> e a todos os projetos que abriram
                    o caminho para que conhecimento e tecnologia fossem compartilhados de forma livre, ética e colaborativa.
                </p>
                <p>
                Também agradecemos profundamente a todos os <strong>professores e professoras</strong> que,
                com paciência e dedicação, compartilham conhecimento e inspiram estudantes todos os dias.
                Este projeto é, em parte, uma homenagem ao trabalho de quem ensina e acredita no poder da educação.
                </p>

                </div>
            
            <div id="tab-termos" class="tab-panel">
                <h3>Termos de Uso</h3>
                <p>Última atualização: 23 de outubro de 2025</p>

                <p style="font-style: italic; background-color: #f0f2f5; padding: 15px; border-radius: 5px;">
                Bem-vindo(a) ao Balanceterno! Estes são os Termos de Uso que regem sua utilização 
                deste site. Nós somos um projeto educacional gratuito e independente, criado 
                para ajudar estudantes.
                </p>
                <p style="font-style: italic; background-color: #f0f2f5; padding: 15px; border-radius: 5px;">
                Ao continuar, você concorda com estas regras. Pedimos que leia com especial 
                atenção a <strong>Seção 2</strong> (que explica que não temos vínculo oficial 
                com o CFC) e a <strong>Seção 4</strong> (que explica que o site é fornecido 
                "como está" e para fins de estudo).
                </p>

                <h4>1. Aceitação dos Termos</h4>
                <p>Ao utilizar este serviço, você confirma que leu, entendeu e concordou com estes Termos e com nossa <a href="#" class="inline-tab-link" data-target-tab="tab-privacidade">Política de Privacidade</a>. Se você não concorda, não utilize este site.</p>

                <h4>2. Descrição do Serviço</h4>
                <p>Este site é um <strong>projeto educacional independente</strong>, sem fins lucrativos, criado para auxiliar estudantes de contabilidade.</p>
                <p><strong>Nós NÃO possuímos nenhum vínculo ou afiliação oficial</strong> com o Conselho Federal de Contabilidade (CFC), com a FGV, com a Consulplan ou com qualquer outra entidade organizadora do Exame de Suficiência.</p>

                <h4>3. Propriedade Intelectual e Licença de Uso</h4>
                <p>Este é um projeto de software livre.</p>
                <ul>
                    <li><strong>Licença do Software:</strong> O código-fonte do site (incluindo HTML, CSS e JavaScript) é disponibilizado sob a <strong>Licença AGPL-3.0</strong>.</li>
                    <li><strong>Licença do Conteúdo:</strong> 
                        <ul>
                            <li><strong>Questões de Exames:</strong> As questões utilizadas são de domínio público, originadas das respectivas bancas (CFC, FGV, Consulplan, etc.) e <strong>não são propriedade deste projeto</strong>.</li>
                            <li><strong>Resoluções e Compilação de Dados:</strong> As resoluções, comentários e a compilação de dados (por exemplo, o arquivo <code>contabilidade-societaria.json</code>) são criações do projeto e disponibilizadas sob a <strong>Licença AGPL-3.0</strong> como parte integrante do software.</li>
                        </ul>
                    </li>
                </ul>
                <p>Isso significa que você é livre para copiar, modificar, distribuir e usar este projeto, desde que você também disponibilize suas modificações sob a mesma licença AGPL-3.0.</p>

                <h4>4. Isenção de Garantias e Limitação de Responsabilidade</h4>
                <p><strong>O site é fornecido "COMO ESTÁ"</strong>: O serviço é oferecido sem qualquer tipo de garantia, expressa ou implícita.</p>
                <p><strong>Precisão do Conteúdo</strong>: Nós nos esforçamos para que as informações (gabaritos, resoluções, enunciados) estejam corretas, mas <strong>NÃO garantimos a precisão</strong>, integridade ou atualidade do conteúdo. O material pode conter erros, estar desatualizado (devido a novas normas) ou incompleto.</p>
                <p><strong>Uso por Sua Conta e Risco</strong>: Todo o conteúdo é disponibilizado <strong>apenas para fins de estudo</strong>. Você é o único responsável por verificar a precisão das informações e por como as utiliza. Não nos responsabilizamos por quaisquer decisões tomadas com base no conteúdo do site.</p>
                <p><strong>Nenhuma Garantia de Aprovação</strong>: O uso desta ferramenta de estudo <strong>NÃO garante sua aprovação</strong> no Exame de Suficiência ou em qualquer outra prova.</p>

                <h4>5. Contribuições do Usuário (Feedback)</h4>
                <p>Nós incentivamos o envio de feedback, correções e sugestões através dos nossos formulários (Google Forms, Microsoft Forms).</p>
                <ul>
                    <li><strong>Licença de Contribuição:</strong> Ao nos enviar feedback ou sugestões, você nos concede uma licença perpétua, irrevogável e gratuita para usar, modificar e incorporar essa informação ao projeto sem qualquer obrigação de crédito ou compensação para você.</li>
                    <li><strong>Créditos Públicos (Opcional):</strong> Se você optar por fornecer seu nome ou apelido no formulário para ser incluído na lista de "Contribuidores", você nos dá consentimento explícito para <strong>exibir publicamente</strong> esse nome em nosso site. Você pode solicitar a remoção do seu nome a qualquer momento.</li>
                    <li><strong>Nomes e Apelidos Inadequados:</strong> Reservamo-nos o direito de recusar ou remover nomes de contribuidores que contenham linguagem ofensiva, discriminatória, difamatória, promocional, política ou qualquer conteúdo considerado inapropriado. A lista de contribuidores destina-se apenas a reconhecer colaborações de forma respeitosa e positiva.</li>
                    <li><strong>Originalidade e Responsabilidade pelo Conteúdo Enviado:</strong> O contribuidor declara que todo o material enviado (como comentários, resoluções, explicações ou sugestões) é de sua <strong>autoria original</strong> e <strong>não infringe direitos autorais de terceiros</strong>. Você <strong>não deve copiar</strong> textos, imagens ou resoluções de outros sites, livros, apostilas ou cursos pagos sem autorização expressa dos respectivos detentores de direitos. Ao enviar uma contribuição, o usuário:</li>
                        <ul>
                            <li>Garante que possui os direitos necessários sobre o conteúdo enviado;</li>
                            <li>Concorda que será o <strong>único responsável</strong> por eventuais reclamações ou disputas relacionadas à originalidade do material;</li>
                            <li>Autoriza o projeto a <strong>remover, editar ou rejeitar</strong> qualquer conteúdo que pareça violar direitos autorais, sem aviso prévio;</li>
                            <li>Reconhece que o projeto <strong>não se responsabiliza</strong> por conteúdo enviado por usuários ou colaboradores externos.</li>
                        </ul>
                </ul>

                <h4>6. Links de Terceiros</h4>
                <p>O site contém links para serviços de terceiros (como Google Forms ou Microsoft Forms) que não são de nossa propriedade ou controle. Não somos responsáveis pelo conteúdo ou pelas práticas de privacidade desses sites.</p>

                <h4>7. Alterações nos Termos</h4>
                <p>Reservamo-nos o direito de modificar estes Termos a qualquer momento. A data da "Última atualização" no topo desta página indicará a versão mais recente.</p>

                <h4>8. Disponibilidade do Serviço</h4>
                <p>Este projeto é mantido de forma independente e voluntária. Embora nossa intenção seja mantê-lo acessível e atualizado, reservamo-nos o direito de modificar, suspender ou descontinuar o site (ou parte dele) a qualquer momento, sem aviso prévio e sem obrigação de manutenção contínua.</p>
                <p>O código-fonte e o conteúdo permanecem disponíveis no repositório público do GitHub, onde a comunidade pode livremente copiar, modificar e continuar o desenvolvimento sob a mesma licença AGPL-3.0.</p>

                <h4>9. Contato</h4>
                <p>Dúvidas sobre estes Termos de Uso? Entre em contato conosco através do <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=DQSIkWdsW0yxEjajBLZtrQAAAAAAAAAAAAYAAF_bnDZUODNHWlVVRFNBNlgwUDlXTUU1VEQ2MEJNRS4u" target="_blank" rel="noopener noreferrer">nosso formulário</a>.</p>
            </div>
            
            <div id="tab-privacidade" class="tab-panel">
                <h3>Política de Privacidade</h3>
                <p>Última atualização: 23 de outubro de 2025</p>

                <p>Esta Política de Privacidade explica quais informações são (ou não são) coletadas quando você utiliza este site (Balanceterno).</p>
                <p>Nosso princípio fundamental é a privacidade. O uso da ferramenta de estudo (filtrar questões, responder ao quiz, ler as resoluções) é 100% privado e não é rastreado ou armazenado.</p>
                <p>As únicas informações que coletamos são aquelas que você <strong>voluntariamente</strong> decide nos enviar através de nossos formulários de feedback.</p>

                <h4>1. Informações que Coletamos (e Por Quê)</h4>
                <p>Este site trata dados pessoais apenas com base no consentimento do usuário, conforme a Lei Geral de Proteção de Dados (Lei nº 13.709/2018).</p>
                <p>Temos duas formas de coleta de dados, ambas opcionais e baseadas no seu consentimento:</p>

                <h5>A) Feedback sobre o Projeto (via Formulários de Terceiros)</h5>
                <ul>
                    <li>Para melhorar este site, podemos disponibilizar links para formulários de feedback (criados em plataformas como Google Forms ou Microsoft Forms).</li>
                    <li>Ao clicar nesses links, você será redirecionado para um site de terceiros. Esse site coletará as respostas que você digitar (sugestões, correções de bugs, etc.).</li>
                    <li><strong>Aviso Importante:</strong> Esses serviços (Google/Microsoft) possuem suas próprias políticas de privacidade e podem coletar dados adicionais, como seu endereço IP ou informações da sua conta, independentemente do nosso controle. Recomendamos que você revise as políticas de privacidade deles.</li>
                </ul>

                <h5>B) Informações para Contribuidores (Opcional)</h5>
                <ul>
                    <li>Em nosso formulário de feedback, você terá a <strong>opção</strong> de fornecer um nome ou apelido.</li>
                    <li><strong>Propósito:</strong> O único propósito de pedir seu nome é para dar o devido crédito público a você na nossa página "Sobre", como um contribuidor do projeto.</li>
                    <li><strong>Uso:</strong> Ao fornecer seu nome, você consente que ele seja exibido publicamente em nosso site.</li>
                    <li>O nome fornecido deve ser adequado e respeitoso. Nomes com linguagem ofensiva, discriminatória, política, comercial ou inapropriada poderão ser recusados ou removidos a qualquer momento.</li>
                    <li>Se você não preencher este campo, seu feedback será enviado de forma anônima.</li>
                </ul>

                <h4>2. O que NÃO Coletamos (Sua Atividade de Estudo)</h4>
                <p>Este site <strong>NÃO</strong> coleta, rastreia ou armazena qualquer informação sobre sua atividade de estudo. Nós não sabemos:</p>
                <ul>
                    <li>Quais filtros você usa;</li>
                    <li>Quais termos você pesquisa;</li>
                    <li>Quais respostas você marca (corretas ou incorretas);</li>
                    <li>Quanto tempo você passa em cada questão.</li>
                </ul>

                <h4>3. Cookies e Armazenamento Local (localStorage)</h4>
                <p>Este site <strong>NÃO</strong> utiliza cookies ou Armazenamento Local (<code>localStorage</code>) para rastrear você ou sua atividade de estudo.</p>

                <h4>4. Rastreadores e Scripts de Terceiros</h4>
                <p>Este site <strong>NÃO</strong> utiliza ferramentas de análise (como Google Analytics) ou pixels de publicidade. O núcleo do site (a ferramenta de questões) é livre de rastreadores.</p>

                <h4>5. Seus Direitos (Remoção de Nome)</h4>
                <p>Se você forneceu seu nome para a lista de contribuidores e, a qualquer momento, desejar que ele seja removido da página "Sobre", por favor, entre em contato conosco. Seu nome será removido prontamente, sem perguntas.</p>

                <h4>6. Contato</h4>
                <p>Se você tiver qualquer dúvida sobre esta Política de Privacidade, sinta-se à vontade para entrar em contato através do <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=DQSIkWdsW0yxEjajBLZtrQAAAAAAAAAAAAYAAF_bnDZUODNHWlVVRFNBNlgwUDlXTUU1VEQ2MEJNRS4u" target="_blank" rel="noopener noreferrer">nosso formulário</a>.</p>
            </div>
            
        </div>
        
        <footer class="site-footer">
            <p>
                &copy; 2025 Balanceterno | Versão 0.10-2 |
                <a href="https://github.com/elrunix12/balanceterno" target="_blank" rel="noopener noreferrer">
                    Código-fonte no GitHub
                </a>
            </p>
            <p>
                Este é um projeto educacional independente, desenvolvido 
para ajudar estudantes e profissionais da contabilidade. Não possuímos 
qualquer vínculo ou afiliação com o Conselho Federal de Contabilidade.
            </p>
            <p>
                Distribuído sob a 
                <a href="https://www.gnu.org/licenses/agpl-3.0.html" target="_blank" rel="noopener noreferrer">
                    Licença AGPL-3.0
                </a>
            </p>
        </footer>

    </div> 
    
    <button id="btn-back-to-top" title="Voltar ao topo">&#8593;</button>

    <script>
    /*
     ____               _                   _   _    _____   ______   _______   ______   _____    _   _    ____  
    |  _ \      /\     | |          /\     | \ | |  / ____| |  ____| |__   __| |  ____| |  __ \  | \ | |  / __ \ 
    | |_) |    /  \    | |         /  \    |  \| | | |      | |__       | |    | |__    | |__) | |  \| | | |  | |
    |  _ <    / /\ \   | |        / /\ \   | . ` | | |      |  __|      | |    |  __|   |  _  /  | . ` | | |  | |
    | |_) |  / ____ \  | |____   / ____ \  | |\  | | |____  | |____     | |    | |____  | | \ \  | |\  | | |__| |
    |____/  /_/    \_\ |______| /_/    \_\ |_| \_|  \_____| |______|    |_|    |______| |_|  \_\ |_| \_|  \____/ 
                                                                                             
    */
        // Copyright (C) 2025 Balanceterno
        //
        // Este programa é um software livre; você pode redistribuí-lo e/ou
        // modificá-lo sob os termos da Licença Pública Geral Affero GNU,
        // conforme publicada pela Free Software Foundation; na versão 3 da
        // Licença, ou (a seu critério) qualquer versão posterior.
        //
        // Este programa é distribuído na esperança de que seja útil,
        // mas SEM NENHUMA GARANTIA; sem mesmo a garantia implícita de
        // COMERCIALIZAÇÃO ou ADEQUAÇÃO A UM DETERMINADO FIM. Consulte a
        // Licença Pública Geral Affero GNU para obter mais detalhes.
        //
        // Você deve ter recebido uma cópia da Licença Pública Geral Affero GNU
        // junto com este programa. Se não, consulte <https://www.gnu.org/licenses/>.
        
        
        // -------------------------------------------------------------------
        //   LÓGICA DA PÁGINA (Refatorada para Múltiplas Disciplinas)
        // -------------------------------------------------------------------
        
        /**
         * (NOVO) Configuração das Disciplinas
         * * Adicione novas disciplinas a este objeto.
         * - A "chave" (ex: "Contabilidade Societária") será o nome no filtro.
         * - 'arquivo': O nome do arquivo JSON para essa disciplina.
         * - 'questoes': Será preenchido automaticamente ao carregar.
         * - 'allTags': Será preenchido automaticamente com todas as ementas (tags)
         * encontradas nesse arquivo.
         */
        const configDisciplinas = {
            "Contabilidade Societária": {
                arquivo: 'contabilidade-societaria.json', // O arquivo que você forneceu
                questoes: [],
                allTags: new Set()
            },
            "Contabilidade de Custos": {
                arquivo: 'contabilidade-custos.json', // O arquivo que você forneceu
                questoes: [],
                allTags: new Set()
            },

            /*
            // Exemplo de como adicionar mais disciplinas no futuro:
            ,
            "Contabilidade de Custos": {
                arquivo: 'db_custos.json',
                questoes: [],
                allTags: new Set()
            },
            "Auditoria": {
                arquivo: 'db_auditoria.json',
                questoes: [],
                allTags: new Set()
            }
            */
        };
        
        // A lista estática de tags foi removida.
        // Elas agora são descobertas dinamicamente a partir dos JSONs.


        // Referências aos elementos do HTML
        const disciplinaCheckContainer = document.getElementById('disciplina-checkbox-container');
        const checkContainer = document.getElementById('checkbox-container'); // Ementas
        const questoesContainer = document.getElementById('questoes-container');
        const infoSpan = document.getElementById('filter-info');
        const btnClear = document.getElementById('btn-clear-filters');
        
        const exameCheckContainer = document.getElementById('exame-checkbox-container'); 
        const sortAnoDropdown = document.getElementById('sort-ano');
        const searchInput = document.getElementById('search-input');
        const btnBackToTop = document.getElementById('btn-back-to-top');
        
        const initialPrompt = document.getElementById('initial-prompt');
        const btnCheckAllDisciplinas = document.getElementById('btn-check-all-disciplinas');
        const btnCheckAllEmentas = document.getElementById('btn-check-all-ementas');


        // Roda tudo quando a página carrega
        document.addEventListener('DOMContentLoaded', () => {

            // --- LÓGICA DAS TABS ---
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabPanels = document.querySelectorAll('.tab-panel');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetId = button.getAttribute('data-target');
                    const targetPanel = document.getElementById(targetId);

                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabPanels.forEach(panel => panel.classList.remove('active'));

                    button.classList.add('active');
                    if (targetPanel) {
                        targetPanel.classList.add('active');
                    }
                });
            });
            // --- FIM: LÓGICA DAS TABS ---

            
            // --- (NOVO) LÓGICA PARA LINKS INTERNOS DAS TABS ---
            const inlineTabLinks = document.querySelectorAll('.inline-tab-link');
            
            inlineTabLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault(); // Impede o link de pular para o topo (href="#")
                    
                    const targetTabId = link.getAttribute('data-target-tab');
                    if (!targetTabId) return;

                    // Encontra o BOTÃO da tab correspondente na navegação principal
                    const targetButton = document.querySelector(`.tab-button[data-target="${targetTabId}"]`);
                    
                    if (targetButton) {
                        targetButton.click(); // Simula o clique no botão da tab
                        
                        // Opcional: Rola a página para o topo para ver a nova tab
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                });
            });
            // --- FIM: LÓGICA PARA LINKS INTERNOS DAS TABS ---

            // (NOVO) Referência ao botão de ocultar ementas
            const btnToggleEmentas = document.getElementById('btn-toggle-ementas');
            
            // (NOVO) Referência à busca de ementas
            const searchEmentasInput = document.getElementById('search-ementas-input');
            

            // --- LÓGICA BOTÃO VOLTAR AO TOPO ---
            window.onscroll = () => {
                if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
                    btnBackToTop.style.display = "block";
                } else {
                    btnBackToTop.style.display = "none";
                }
            };
            btnBackToTop.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            // --- FIM: LÓGICA BOTÃO VOLTAR AO TOPO ---

            // --- (NOVO/MODIFICADO) LÓGICA DE OCULTAR E FILTRAR EMENTAS ---
            
            // Lógica do botão [ Ocultar / Exibir ]
            btnToggleEmentas.addEventListener('click', () => {
                // (MODIFICADO) Alvo agora é o WRAPPER
                const wrapper = document.getElementById('ementas-toggle-wrapper');
                const isVisible = btnToggleEmentas.dataset.visible === 'true';
                
                if (isVisible) {
                    wrapper.style.display = 'none';
                    btnToggleEmentas.dataset.visible = 'false';
                    btnToggleEmentas.textContent = '[ Exibir ]';
                } else {
                    wrapper.style.display = 'block'; // Restaura o 'block' do wrapper
                    btnToggleEmentas.dataset.visible = 'true';
                    btnToggleEmentas.textContent = '[ Ocultar ]';
                }
            });
            
            // (NOVO) Lógica do campo de busca de ementas
            searchEmentasInput.addEventListener('input', filtrarEmentasPorTexto);
            
            // --- FIM: LÓGICA DE OCULTAR E FILTRAR EMENTAS ---

            // --- (NOVO) LÓGICA PARA TOOLTIP DE QUESTÕES OBSOLETAS (MOBILE) ---
            const obsoletaTooltip = document.getElementById('obsoleta-tooltip-trigger');
            if (obsoletaTooltip) {
                obsoletaTooltip.addEventListener('click', (e) => {
                    // Impede que o clique no "?" ative o <label> e mude o radio button
                    e.preventDefault(); 
                    e.stopPropagation(); 
                    
                    const message = obsoletaTooltip.getAttribute('title');
                    if (message) {
                        alert(message); // Mostra o texto do 'title' em um alerta
                    }
                });
            }
            // --- FIM: LÓGICA DO TOOLTIP ---
            
            // --- LÓGICA DE CARREGAMENTO E FILTROS ---
            
            // (MODIFICADO) Função para carregar TODOS os JSONs das disciplinas
            async function carregarDados() {
                const promessas = Object.entries(configDisciplinas).map(async ([nome, config]) => {
                    try {
                        const response = await fetch(config.arquivo);
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status} para ${config.arquivo}`);
                        }
                        const data = await response.json();
                        
                        // Armazena as questões e descobre as tags
                        config.questoes = data;
                        data.forEach(q => {
                            // (NOVO) Adiciona a qual disciplina a questão pertence
                            q.disciplina = nome; 
                            // Popula o Set de tags
                            if (q.tags && Array.isArray(q.tags)) {
                                q.tags.forEach(tag => config.allTags.add(tag));
                            }
                        });
                        
                    } catch (error) {
                        console.error(`Erro ao carregar a disciplina "${nome}" (${config.arquivo}):`, error);
                        // Você pode querer tratar o erro de forma mais visível aqui
                    }
                });

                // Espera todas as disciplinas carregarem
                await Promise.all(promessas);

                // Agora que os dados carregaram, inicie a renderização dos filtros
                renderizarFiltrosDeDisciplina();
                renderizarFiltrosDeExame(); // Filtros de exame ainda são de todos os JSONs
                renderizarFiltrosDeEmenta(); // Renderiza ementas (inicialmente vazio)
                
                // (NOVO) Renderiza as questões uma vez para mostrar o prompt inicial
                renderizarQuestoes(); 
            }

            // Inicia o carregamento dos dados
            carregarDados();
            
            
            // --- Listeners para os filtros ---
            
            btnClear.addEventListener('click', () => {
                // Limpa Disciplinas
                disciplinaCheckContainer.querySelectorAll('input[type="checkbox"]').forEach(check => {
                    check.checked = false;
                });
                // Limpa Ementas
                checkContainer.querySelectorAll('input[type="checkbox"]').forEach(check => {
                    check.checked = false;
                });
                // Limpa Exames
                exameCheckContainer.querySelectorAll('input[type="checkbox"]').forEach(check => {
                    check.checked = false;
                });
                
                sortAnoDropdown.value = 'decrescente';
                searchInput.value = ''; // Limpa a Pesquisa
                document.getElementById('obsoleta-sim').checked = true;
                
                // (NOVO) Re-renderiza tudo, o que vai re-esconder as questões
                // e mostrar o prompt inicial.
                renderizarFiltrosDeEmenta(); // Limpa as ementas
                renderizarQuestoes();

                // --- (MODIFICADO) ---
                // Garante que o WRAPPER de ementas reapareça
                document.getElementById('ementas-toggle-wrapper').style.display = 'block';
                btnToggleEmentas.dataset.visible = 'true';
                btnToggleEmentas.textContent = '[ Ocultar ]';
                
                // (NOVO) Limpa a busca de ementas
                searchEmentasInput.value = '';
                // --- FIM DA MODIFICAÇÃO ---
            });

            // (NOVO) Listeners dos botões "Marcar Todos"
            btnCheckAllDisciplinas.addEventListener('click', () => {
                const newState = btnCheckAllDisciplinas.dataset.checked === 'false';
                disciplinaCheckContainer.querySelectorAll('input[type="checkbox"]').forEach(check => {
                    check.checked = newState;
                });
                btnCheckAllDisciplinas.dataset.checked = newState;
                btnCheckAllDisciplinas.textContent = newState ? "Desmarcar Todas" : "Marcar Todas";
                
                // Atualiza filtros dependentes e questões
                renderizarFiltrosDeEmenta();
                renderizarQuestoes();
            });

            btnCheckAllEmentas.addEventListener('click', () => {
                const newState = btnCheckAllEmentas.dataset.checked === 'false';
                
                // (MODIFICADO) Itera nos labels, e não nos inputs
                checkContainer.querySelectorAll('.ementa-group-grid label').forEach(label => {
                    // Só afeta labels que estão visíveis (não filtrados pela busca)
                    if (label.style.display !== 'none') {
                        const check = label.querySelector('input[type="checkbox"]');
                        if (check) {
                            check.checked = newState;
                        }
                    }
                });
                
                btnCheckAllEmentas.dataset.checked = newState;
                btnCheckAllEmentas.textContent = newState ? "Desmarcar Todas" : "Marcar Todas";

                // Atualiza questões
                renderizarQuestoes();
            });


            sortAnoDropdown.addEventListener('change', renderizarQuestoes);
            searchInput.addEventListener('input', renderizarQuestoes);
            document.querySelectorAll('input[name="obsoleta-filter"]').forEach(radio => {
                radio.addEventListener('change', renderizarQuestoes);
            });
            // --- FIM: LÓGICA DE CARREGAMENTO E FILTROS ---
        });

        // 0. Função Helper para remover acentos
        function normalizeText(text) {
            if (typeof text !== 'string') return '';
            return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        }

        // 1. (NOVO) Função para criar os checkboxes de DISCIPLINA
        function renderizarFiltrosDeDisciplina() {
            let filterHTML = '';
            
            // Ordena os nomes das disciplinas alfabeticamente
            const nomesDisciplinas = Object.keys(configDisciplinas).sort((a, b) => a.localeCompare(b, 'pt-BR'));
            
            nomesDisciplinas.forEach(nome => {
                const count = configDisciplinas[nome].questoes.length;
                filterHTML += `
                    <label>
                        <input type="checkbox" class="disciplina-filter-check" value="${nome}">
                        ${nome} (${count})
                    </label>
                `;
            });
            disciplinaCheckContainer.innerHTML = filterHTML;

            // Adiciona os listeners
            disciplinaCheckContainer.querySelectorAll('.disciplina-filter-check').forEach(check => {
                check.addEventListener('change', () => {
                    // (NOVO) Quando uma disciplina muda,
                    // atualizamos a lista de ementas E as questões.
                    renderizarFiltrosDeEmenta();
                    renderizarQuestoes();
                });
            });
        }

        // 2. (MODIFICADO) Função para criar os checkboxes de EMENTA (agora dinâmico e agrupado)
        function renderizarFiltrosDeEmenta() {
            
            // (ETAPA 1) Armazena quais ementas JÁ ESTAVAM MARCADAS
            const ementasMarcadasAnteriormente = new Set(
                Array.from(checkContainer.querySelectorAll('.filter-check:checked'))
                     .map(check => check.value)
            );

            // (ETAPA 2) Pega as disciplinas selecionadas
            const disciplinasSelecionadas = Array.from(
                disciplinaCheckContainer.querySelectorAll('.disciplina-filter-check:checked')
            ).map(check => check.value);

            // (ETAPA 3) Se não houver disciplinas, mostra aviso
            if (disciplinasSelecionadas.length === 0) {
                checkContainer.innerHTML = '<p style="font-size: 0.9em; color: #777; margin: 0;">(Selecione uma disciplina para ver as ementas)</p>';
                btnCheckAllEmentas.style.display = 'none';

                // --- (MODIFICADO) ---
                // Força a exibição do WRAPPER para mostrar o aviso
                document.getElementById('ementas-toggle-wrapper').style.display = 'block';
                // (NOVO) Oculta o campo de busca, pois não há o que buscar
                document.getElementById('search-ementas-input').parentElement.style.display = 'none'; 
                
                const btnToggleEmentas = document.getElementById('btn-toggle-ementas');
                if (btnToggleEmentas) {
                    btnToggleEmentas.dataset.visible = 'true';
                    btnToggleEmentas.textContent = '[ Ocultar ]';
                }
                // --- FIM DA MODIFICAÇÃO ---

                return;
            }

            // (ETAPA 4 - NOVA LÓGICA) Constrói o HTML agrupado
            btnCheckAllEmentas.style.display = 'inline-block';
            
            // (NOVO) Mostra o campo de busca
            document.getElementById('search-ementas-input').parentElement.style.display = 'block';

            let finalHTML = ''; // O HTML final para o checkContainer

            // Ordena as disciplinas selecionadas para que os grupos apareçam em ordem
            disciplinasSelecionadas.sort((a, b) => a.localeCompare(b, 'pt-BR'));

            disciplinasSelecionadas.forEach(nomeDisciplina => {
                // Pega as tags *desta* disciplina
                const tagsDaDisciplina = Array.from(configDisciplinas[nomeDisciplina].allTags).sort();
                
                // Se a disciplina não tiver tags, pula para a próxima
                if (tagsDaDisciplina.length === 0) return;

                let groupCheckboxHTML = ''; // HTML para os checkboxes <label>
                tagsDaDisciplina.forEach(tag => {
                    // Verifica se esta tag estava marcada anteriormente
                    const isChecked = ementasMarcadasAnteriormente.has(tag) ? 'checked' : '';
                    groupCheckboxHTML += `
                        <label>
                            <input type="checkbox" class="filter-check" value="${tag}" ${isChecked}>
                            ${tag}
                        </label>
                    `;
                });

                // Adiciona o grupo completo (label + grid de checkboxes) ao HTML final
                finalHTML += `
                    <div class="ementa-group">
                        <p class="ementa-group-label">${nomeDisciplina}</p>
                        <div class="ementa-group-grid">
                            ${groupCheckboxHTML}
                        </div>
                    </div>
                `;
            });
            
            // (ETAPA 5) Renderiza o HTML final no container
            checkContainer.innerHTML = finalHTML;

            // (ETAPA 6) Adiciona os listeners
            checkContainer.querySelectorAll('.filter-check').forEach(check => {
                check.addEventListener('change', renderizarQuestoes);
            });
            
            // (ETAPA 7) Reseta o botão "Marcar Todas"
            btnCheckAllEmentas.dataset.checked = 'false';
            btnCheckAllEmentas.textContent = 'Marcar Todas';
            
            // (NOVO - ETAPA 8) Re-aplica o filtro de texto
            filtrarEmentasPorTexto();
        }


        // 3. (MODIFICADO) Função para criar os checkboxes de EXAME (dinâmico)
        function renderizarFiltrosDeExame() {
            const masterExameSet = new Set();
            
            // Coleta exames de TODAS as disciplinas carregadas
            Object.values(configDisciplinas).forEach(config => {
                config.questoes.forEach(q => masterExameSet.add(q.exame));
            });

            const exames = Array.from(masterExameSet);
            
            // Lógica de ordenação (existente)
            const parseExame = (exameStr) => {
                const matchComParte = exameStr.match(/(\d{4})\/(\d)/);
                const matchRS = exameStr.match(/(\d{4})\/1 RS/);
                const matchAno = exameStr.match(/(\d{4})/);

                if (matchRS) return { ano: parseInt(matchRS[1]), parte: 1.5 };
                if (matchComParte) return { ano: parseInt(matchComParte[1]), parte: parseInt(matchComParte[2]) };
                if (matchAno) return { ano: parseInt(matchAno[1]), parte: 0 };
                return { ano: 0, parte: 0 };
            };
            exames.sort((a, b) => {
                const parsedA = parseExame(a);
                const parsedB = parseExame(b);
                if (parsedB.ano !== parsedA.ano) return parsedB.ano - parsedA.ano;
                if (parsedB.parte !== parsedA.parte) return parsedB.parte - parsedA.parte;
                return a.localeCompare(b);
            });
            
            let exameFilterHTML = '';
            exames.forEach(exame => {
                exameFilterHTML += `
                    <label>
                        <input type="checkbox" class="exame-filter-check" value="${exame}">
                        ${exame}
                    </label>
                `;
            });
            exameCheckContainer.innerHTML = exameFilterHTML;

            exameCheckContainer.querySelectorAll('.exame-filter-check').forEach(check => {
                check.addEventListener('change', renderizarQuestoes);
            });
        }


        // 4. (MODIFICADO) Função principal para filtrar e mostrar as questões
        function renderizarQuestoes() {
            
            // 1. Pega filtros de DISCIPLINA
            const filtrosDisciplina = Array.from(
                disciplinaCheckContainer.querySelectorAll('.disciplina-filter-check:checked')
            ).map(check => check.value);

            // (NOVO - REQUISITO 3) Se nenhuma disciplina estiver marcada, mostra o prompt
            if (filtrosDisciplina.length === 0) {
                questoesContainer.innerHTML = ''; // Limpa questões
                questoesContainer.style.display = 'none'; // Esconde container
                initialPrompt.style.display = 'block'; // Mostra prompt
                infoSpan.textContent = ''; // Limpa info
                return;
            }
            
            // (NOVO) Se chegou aqui, esconde o prompt e mostra o container de questões
            questoesContainer.style.display = 'block';
            initialPrompt.style.display = 'none';

            // 2. Pega filtros de Ementa
            const filtrosEmenta = Array.from(
                checkContainer.querySelectorAll('.filter-check:checked')
            ).map(check => check.value);

            // 3. Pega filtros de EXAME
            const examesSelecionados = Array.from(
                exameCheckContainer.querySelectorAll('.exame-filter-check:checked')
            ).map(check => check.value);

            // 4. Pega ordem do Sort
            const sortOrder = sortAnoDropdown.value;
            
            // 5. Pega o termo da Pesquisa
            const searchTerm = normalizeText(searchInput.value.toLowerCase().trim());
            
            // 6. Pega filtro de obsoletas
            const mostrarObsoletas = document.querySelector('input[name="obsoleta-filter"]:checked').value;

            // (MODIFICADO) Constrói a lista de questões base
            // a partir APENAS das disciplinas selecionadas.
            let questoesParaFiltrar = [];
            filtrosDisciplina.forEach(nome => {
                questoesParaFiltrar.push(...configDisciplinas[nome].questoes);
            });

            // (NOVO) Este é o novo "total" para o span de info
            const totalQuestoesDasDisciplinas = questoesParaFiltrar.length;
            
            // 7. Aplica filtro de obsoletas
            if (mostrarObsoletas === 'nao') {
                questoesParaFiltrar = questoesParaFiltrar.filter(questao => !questao.obsoleta);
            }

            // 8. (MODIFICADO) Aplica filtro de Ementa (Lógica "OU")
            // Se houver filtros de ementa, aplica.
            // Se não houver, mostra todas as questões das disciplinas (lógica "OU")
            if (filtrosEmenta.length > 0) {
                questoesParaFiltrar = questoesParaFiltrar.filter(questao => {
                    // (REQUISITO 4) .some() = Lógica "OU" (acumulativo)
                    // A questão passa se tiver PELO MENOS UMA das tags selecionadas.
                    return filtrosEmenta.some(filtro => questao.tags && questao.tags.includes(filtro));
                });
            }

            // 9. Aplica filtro de EXAME
            if (examesSelecionados.length > 0) {
                questoesParaFiltrar = questoesParaFiltrar.filter(questao => {
                    return examesSelecionados.includes(questao.exame);
                });
            }
            
            // 10. Aplica filtro de PESQUISA
            if (searchTerm.length > 0) {
                questoesParaFiltrar = questoesParaFiltrar.filter(questao => {
                    const enunciadoLower = normalizeText(questao.enunciado.toLowerCase());
                    const opcoesLower = normalizeText(questao.opcoes.map(op => op.texto.toLowerCase()).join(' '));
                    const resolucaoLower = normalizeText((questao.resolucao || '').toLowerCase());

                    return enunciadoLower.includes(searchTerm) || 
                           opcoesLower.includes(searchTerm) ||
                           resolucaoLower.includes(searchTerm);
                });
            }

            // 11. Aplica Ordenação (Lógica existente)
             const parseExameParaSort = (exameStr) => {
                const matchComParte = exameStr.match(/(\d{4})\/(\d)/);
                const matchRS = exameStr.match(/(\d{4})\/1 RS/);
                const matchAno = exameStr.match(/(\d{4})/);

                if (matchRS) return { ano: parseInt(matchRS[1]), parte: 1.5 };
                if (matchComParte) return { ano: parseInt(matchComParte[1]), parte: parseInt(matchComParte[2]) };
                if (matchAno) return { ano: parseInt(matchAno[1]), parte: 0 };
                return { ano: 0, parte: 0 };
            };
            questoesParaFiltrar.sort((a, b) => {
                const parsedA = parseExameParaSort(a.exame);
                const parsedB = parseExameParaSort(b.exame);
                if (sortOrder === 'crescente') {
                    if (parsedA.ano !== parsedB.ano) return parsedA.ano - parsedB.ano;
                    if (parsedA.parte !== parsedB.parte) return parsedA.parte - parsedB.parte;
                    return a.id - b.id;
                } else {
                    if (parsedB.ano !== parsedA.ano) return parsedB.ano - parsedA.ano; 
                    if (parsedB.parte !== parsedA.parte) return parsedB.parte - parsedB.parte;
                    return b.id - a.id;
                }
            });

            // 12. (MODIFICADO) Atualiza o texto de informação
            const totalMostrando = questoesParaFiltrar.length;
            if (totalMostrando === totalQuestoesDasDisciplinas && totalMostrando > 0) {
                infoSpan.textContent = `Exibindo todas as ${totalQuestoesDasDisciplinas} questões das disciplinas selecionadas.`;
            } else {
                infoSpan.textContent = `Exibindo ${totalMostrando} de ${totalQuestoesDasDisciplinas} questões (das disciplinas selecionadas).`;
            }

            // 13. Gera o HTML para as questões filtradas
            questoesContainer.innerHTML = '';
            if (questoesParaFiltrar.length === 0) {
                questoesContainer.innerHTML = '<p style="text-align: center; padding: 20px;">Nenhuma questão encontrada com os filtros selecionados.</p>';
                return; // Encerra aqui
            }

            questoesParaFiltrar.forEach(questao => {
                let opcoesHTML = '';
                questao.opcoes.forEach(opcao => {
                    opcoesHTML += `<li class="opcao-clicavel" data-letra="${opcao.letra}"><strong>(${opcao.letra})</strong> ${opcao.texto}</li>`;
                });

                const safeExameId = questao.exame.replace(/[^a-zA-Z0-9]/g, '-'); 
                const uniqueID = `resposta-${safeExameId}-${questao.id}`; 
                
                const obsoletaTagHTML = questao.obsoleta ? '<span class="tag-obsoleta">Questão Obsoleta</span>' : '';
                
                // (NOVO) Adiciona a tag da disciplina
                const disciplinaTagHTML = `<span class="disciplina">${questao.disciplina}</span>`;
                
                let resolucaoHTML = '';
                if (questao.resolucao && questao.resolucao.trim() !== '') {
                    resolucaoHTML = `<div class="resolucao-texto"><strong>Resolução Comentada:</strong><br>${questao.resolucao}</div>`;
                } else {
                    resolucaoHTML = `<div class="sem-resolucao">Esta questão ainda não possui uma resolução comentada. Gostaria de ajudar a construí-la? Acesse a aba "Sobre" e saiba como!</div>`;
                }
                
                const cardHTML = `
                    <div class="questao-card" data-gabarito="${questao.gabarito}">
                        <div class="questao-header">
                            <h4>Questão ${questao.id}</h4>
                            
                            <div class="questao-meta">
                                <span>${questao.exame}</span> 
                                <span class="banca">${questao.banca}</span> 
                                ${obsoletaTagHTML} 
                            </div>

                        </div>
                        
                        <div class="questao-disciplina-container">
                            ${disciplinaTagHTML}
                        </div>
                        
                        <p class="enunciado">${questao.enunciado}</p>
                        <div class="opcoes">
                            <ul class="opcoes-lista" data-target-id="${uniqueID}">
                                ${opcoesHTML}
                            </ul>
                        </div>
                        
                        <small class="quiz-hint">Clique em uma das opções acima para ver o gabarito.</small>
                        
                        <div class="resposta-correta" id="${uniqueID}">
                            <div class="gabarito-texto">
                                <strong>Gabarito: (${questao.gabarito})</strong> ${questao.gabarito_texto}
                            </div>
                            ${resolucaoHTML} 
                        </div>
                    </div>
                `;
                
                questoesContainer.innerHTML += cardHTML;
            });

            // 14. (MODIFICADO) Adiciona eventos de clique às opções
            adicionarEventosQuiz();
        }

        // 5. (MODIFICADO) Função para fazer o modo "estudo" (com toggle) funcionar
        // (A lógica interna desta função não precisou de alteração)
        function adicionarEventosQuiz() {
            const listasOpcoes = document.querySelectorAll('.opcoes-lista');

            listasOpcoes.forEach(ul => {
                ul.addEventListener('click', (e) => {
                    const liClicado = e.target.closest('li.opcao-clicavel');
                    if (!liClicado) { return; }

                    const letraClicada = liClicado.getAttribute('data-letra');
                    const card = ul.closest('.questao-card');
                    const gabarito = card.getAttribute('data-gabarito');
                    const targetId = ul.getAttribute('data-target-id');
                    const respostaDiv = document.getElementById(targetId);
                    const hint = card.querySelector('.quiz-hint');

                    const isAlreadyActive = liClicado.classList.contains('opcao-correta') || liClicado.classList.contains('opcao-incorreta');

                    ul.querySelectorAll('li.opcao-clicavel').forEach(li => {
                        li.classList.remove('opcao-correta', 'opcao-incorreta');
                    });

                    if (isAlreadyActive) {
                        respostaDiv.style.display = 'none';
                        if (hint) hint.style.display = 'block';
                    } else {
                        respostaDiv.style.display = 'block';
                        if (hint) hint.style.display = 'none';

                        if (letraClicada === gabarito) {
                            liClicado.classList.add('opcao-correta');
                        } else {
                            liClicado.classList.add('opcao-incorreta');
                        }
                    }
                });
            });
        }
        
        // (NOVA FUNÇÃO) Filtra as ementas visíveis baseado no input
        function filtrarEmentasPorTexto() {
            const searchTerm = normalizeText(document.getElementById('search-ementas-input').value.toLowerCase());
            const grupos = document.querySelectorAll('#checkbox-container .ementa-group');

            grupos.forEach(grupo => {
                let visiveisNoGrupo = 0;
                const labels = grupo.querySelectorAll('.ementa-group-grid label');

                labels.forEach(label => {
                    const labelText = normalizeText(label.textContent.toLowerCase());
                    
                    if (labelText.includes(searchTerm)) {
                        label.style.display = 'flex'; // Mostra o label
                        visiveisNoGrupo++;
                    } else {
                        label.style.display = 'none'; // Esconde o label
                    }
                });

                // Agora, verifica o grupo
                if (visiveisNoGrupo > 0) {
                    grupo.style.display = 'block'; // Mostra o grupo (e seu título)
                } else {
                    grupo.style.display = 'none'; // Esconde o grupo (e seu título)
                }
            });
        }

    </script>

</body>
</html>
